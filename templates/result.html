<!DOCTYPE html>
<html>
<head>
    <title>Performance Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="bg-light">

<div class="container mt-5">

    <!-- Title -->
    <h2 class="text-center mb-4">Performance Dashboard</h2>

    <!-- Score Cards -->
    <div class="row text-center mb-4">

        <div class="col-md-4">
            <div class="card shadow bg-primary text-white p-3">
                <h5>Your Score</h5>
                <h3>{{ score }}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow bg-success text-white p-3">
                <h5>Your Level</h5>
                <h3>{{ level }}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow bg-dark text-white p-3">
                <h5>Average Score</h5>
                <h3>{{ average }}</h3>
            </div>
        </div>

    </div>

    <!-- Feedback Section -->
    <div class="card shadow p-4 mb-4">
        <h5>{{ message }}</h5>
        <h5 class="{{ status }}">{{ improvement_message }}</h5>
    </div>

    <!-- Previous Attempts Table -->
    <div class="card shadow p-4 mb-4">
        <h4>Previous Attempts</h4>

        <table class="table table-center table-bordered table-striped mt-3">
            <thead class="table-success text-center">
                <tr>
                    <th>Score</th>
                    <th>Level</th>
                </tr>
            </thead>

            <tbody>
                {% for row in history %}
                <tr>
                    <td>{{ row[0] }}</td>
                    <td>{{ row[1] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Graph -->
    <div class="card shadow p-4 mb-4">
        <h4>Performance Graph</h4>
        <canvas id="myChart"></canvas>
    </div>

    <!-- Logout -->
    <div class="text-center mb-5">
        <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const scores = {{ scores | tojson }};
    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: scores.map((_, index) => "Attempt " + (index + 1)),
            datasets: [{
                label: 'Score',
                data: scores,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: 2
                }
            }
        }
    });
</script>

</body>
</html>
